name: CD (Docker & Pages)

on:
  workflow_run:
    workflows: ["CI (Build & Test)"]
    types: [completed]
    branches: [main]

concurrency:
  group: cd-${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: false

permissions:
  contents: read
  packages: write
# pages: write      # Only uncomment once you try to deploy GitHub Pages
# id-token: write   # Only uncomment once you try to deploy-pages for OIDC

jobs:
   docker:
    name: Build, Push & E2E
    if: ${{ github.event.workflow_run.conclusion == 'success'}}
    runs-on: ubuntu-latest

   steps:
     - name: Checkout CI commit
       uses: actions/checkout@v4
       with:
        ref: ${{ github.event.workflow_run.head_sha}}

     - name: Setup Docker Buildx
       uses: docker/setup-buildx-action@v3

#    - name: Login to Docker Hub
#      uses: #TODO1
#      with:
#        username: ${{ TODO2 }}
#        password: ${{ TODO3 }}
#
#      - name: Build & push Docker Hub image
#        uses: TODO4
#        with:
#          context: .
#          push: #TODO5
#          tags: |
#        ${{ TODO6 }}/esd:latest
#        ${{ TODO6 }}/esd:${{ TODO6 }}


#      - name: E2E test against Docker Hub image
#        run: |
#          set -e
#          IMAGE="${{ vars.DOCKERHUB_USERNAME }}/esd:latest"
#          CONTAINER_NAME="workshop-app"

#          docker run -d --rm \
#            --name "$CONTAINER_NAME" \
#            -p 8080:8080 \
#            -e APP_COMMIT=${GITHUB_SHA::12} \
#            "$IMAGE"
#
#          for i in {1..30}; do
#            if curl -fsS http://localhost:8080/api/health; then
#              echo "Health OK"
#              break
#            fi
#            sleep 2
#          done
#
#          curl -fsS http://localhost:8080/api/info
#          docker stop "$CONTAINER_NAME"

#  pages:
#    name: Deploy Pages
#    needs: #TODO7
#   runs-on: ubuntu-latest


    #Same set up as we already did in the CI so we did it for you this time :)
#     steps:
#      - name: Checkout CI commit
#        uses: actions/checkout@v4
#        with:
#          ref: ${{ github.event.workflow_run.head_sha || github.sha }}
#
#      - name: Set up JDK 17
#        uses: actions/setup-java@v4
#        with:
#          distribution: temurin
#          java-version: 17

#      - name: Setup Gradle
#       uses: #TODO8
#
#
#     - name: Build Docs (export pages)
#       run: #TODO9
#
#     - name: Upload artifact
#       uses: #TODO10
#       with:
#         path: #TODO11
#
#     - name: Deploy GitHub Pages
#       uses: #TODO12

     - name: TODO â€“ Login, Upload Image and E2E Test Docker, Deploy to GitHub Pages
       run: echo "Login, Upload Image and E2E Test Docker, Deploy to GitHub Pages. (You can delete this after successfully implementing the TODOS)"





